// ============================================================================
// File: rpc_response.fbs
// Namespace: fbs.cuda.ipc.api
// ---------------------------------------------------------------------------
// RPC Response tables for CUDA IPC, using common definitions.
// ============================================================================

include "common.fbs";

namespace fbs.cuda.ipc.api;

// ---------------------------------------------------------------------------
// RPC Response Tables
// --------------------------------------------------------------------------
table GetAvailableGPUsResponse{
  gpus: [UUID]; // Array of GPU UUIDs
}

table GetAllocatedTotalBufferCountResponse {
  value: uint64; // Total number of allocated buffers
}

table GetAllocatedTotalBytesResponse {
  value: uint64; // Total allocated bytes
}

table GetMaxAllocationBytesResponse {
  value: uint64; // Maximum allocation size in bytes
}

// ---------------------------------------------------------------------------
// Response for buffer creation
// ---------------------------------------------------------------------------
table CreateCUDABufferResponse {
  gpu_uuid: UUID (required);         // UUID of the GPU where the buffer resides
  buffer_id: UUID (required);        // Unique identifier for the created CUDA buffer
  ipc_handle: CudaIPCHandle (required); // IPC handle to share the buffer across processes
  size: uint64;                      // Size of the buffer in bytes
  access_id: uint32;                 // Access ID associated with the buffer
}

// ---------------------------------------------------------------------------
// Response for buffer retrieval
// ---------------------------------------------------------------------------
table GetCUDABufferResponse {
  gpu_uuid: UUID (required);         // UUID of the GPU where the buffer resides
  ipc_handle: CudaIPCHandle (required);         // IPC handle to access the requested buffer
  size: uint64;                      // Size of the buffer in bytes
  access_id: uint32;                 // Access ID for the buffer
}

// ---------------------------------------------------------------------------
// Response for notify done
// ---------------------------------------------------------------------------
table NotifyDoneResponse {
  // No fields required; used to acknowledge completion of an operation
}

// ---------------------------------------------------------------------------
// Response for buffer free
// ---------------------------------------------------------------------------
table FreeCUDABufferResponse {
  // No fields required; used to acknowledge buffer release
}

// ---------------------------------------------------------------------------
// Error Response
// ---------------------------------------------------------------------------
table ErrorResponse {
   message: string; // Error message response
}

// ---------------------------------------------------------------------------
// Union of all possible RPC response types
// ---------------------------------------------------------------------------
union RPCResponse {
  GetAvailableGPUsResponse,
  GetAllocatedTotalBufferCountResponse,
  GetAllocatedTotalBytesResponse,
  GetMaxAllocationBytesResponse,
  CreateCUDABufferResponse,
  GetCUDABufferResponse,
  NotifyDoneResponse,
  FreeCUDABufferResponse,
  ErrorResponse
}

// ---------------------------------------------------------------------------
// Root type for RPC response messages
// ---------------------------------------------------------------------------
table RPCResponseMessage {
  response: RPCResponse (required); // The actual RPC response payload
}

root_type RPCResponseMessage;
